WITH g1 AS (SELECT cust, COUNT(quant) AS count_1_quant FROM sales WHERE state = 'NY' GROUP BY cust), g2 AS (SELECT cust, SUM(quant) AS sum_2_quant FROM sales WHERE state = 'NJ' GROUP BY cust), g3 AS (SELECT cust, MAX(quant) AS max_3_quant FROM sales WHERE state = 'CT' GROUP BY cust) SELECT distinct sales.cust, g1.count_1_quant AS count_1_quant, g2.sum_2_quant AS sum_2_quant, g3.max_3_quant AS max_3_quant FROM sales JOIN g1 ON sales.cust = g1.cust JOIN g2 ON sales.cust = g2.cust JOIN g3 ON sales.cust = g3.cust order by sales.cust